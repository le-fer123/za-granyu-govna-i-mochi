{% extends "main/base2ch.html" %}
{% block title %} NE2ch {% endblock %}
{% block content %}

<div style="text-align: center">
    <form method="POST" action="{% url 'filepostview' %}" id="download-form" enctype="multipart/form-data">
        {% csrf_token %}
        <label for="title">Title:</label>
        <input type="text" id="title" name="title"> <br><br>
        <label for="file">File:</label>
        <input type="file" id="file" name="file"> <br><br>
        <label for="text">Text: </label>
        <textarea id="text" name="data" rows="50" cols="80"></textarea> <br><br>
        <button type="submit" id="submit-btn">
            <span class="btn-text">Загрузить</span>
            <div class="loader d-none"></div>
        </button>
    </form>
</div>

<script>
document.getElementById('download-form').addEventListener('submit', function(e) {
    e.preventDefault();

    var formData = new FormData(this);

    var xhr = new XMLHttpRequest();
    xhr.open('POST', this.action, true);
    xhr.upload.addEventListener('progress', function(e) {
        if (e.lengthComputable) {
            var percent = (e.loaded / e.total) * 100;
            console.log('Загружено: ' + percent.toFixed(2) + '%');
        }
    });

    xhr.onload = function() {
        if (xhr.status === 200) {
            console.log('Файл успешно загружен');
        } else {
            console.error('Ошибка загрузки: ' + xhr.statusText);
        }
    };

    xhr.onerror = function() {
        console.error('Ошибка соединения');
    };

    xhr.send(formData);
});
</script>

{% endblock %}
